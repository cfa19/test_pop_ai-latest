services:
  - type: web
    name: pop-skills-api
    runtime: docker
    plan: free
    dockerfilePath: ./Dockerfile
    healthCheckPath: /health
    envVars:
      # Supabase
      - key: SUPABASE_URL
        sync: false
      - key: SUPABASE_SERVICE_ROLE_KEY
        sync: false

      # OpenAI
      - key: OPENAI_API_KEY
        sync: false

      # Voyage AI (Embeddings)
      - key: VOYAGE_API_KEY
        sync: false
      - key: EMBED_MODEL
        value: voyage-3-large
      - key: EMBED_DIMENSIONS
        value: "1024"

      # Chat
      - key: CHAT_MODEL
        value: gpt-4o-mini
      - key: CHAT_PROVIDER
        value: openai
      - key: EMBED_PROVIDER
        value: voyage

      # Intent Classifier (ONNX - local, no downloads)
      - key: INTENT_CLASSIFIER_TYPE
        value: onnx
      - key: INTENT_CLASSIFIER_MODEL_PATH
        value: training/models/onnx/classifier

      # Semantic Gate
      - key: SEMANTIC_GATE_ENABLED
        value: "true"
      - key: SEMANTIC_GATE_TUNING_PATH
        value: training/results/semantic_gate_tuning.json

      # JWT
      - key: JWT_ALGORITHM
        value: ES256
